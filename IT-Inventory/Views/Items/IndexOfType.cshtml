@model IT_Inventory.ViewModels.ItemIndexViewModel

@{
    ViewBag.Title = Model.Type.Name;
}

<h2>@ViewBag.Title</h2>

<p>
    @Html.ActionLink("Всё оборудование", "Index", null, new { @class = "btn btn-primary btn-lg", href = "/Items/Index" })
    @Html.ActionLink("Добавить " + Model.Type.Name.ToLower(), "Create", new { id = Model.Type.Id }, new {@class = "btn btn-default btn-lg"})
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Items.First().Name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Items.First().Quantity)
        </th>
        @if (Model.Type.Id == 11)
        {
            <th>
                Принтеры
            </th>
        }
        @if (Model.Items.FirstOrDefault() != null)
        {
            foreach (var attribute in Model.Items.FirstOrDefault().ItemType.Attributes)
            {
                <th>
                    @Html.DisplayName(attribute.Name)
                </th>
            }
        }

        <th></th>
    </tr>

@foreach (var item in Model.Items)
{
    <tr style="@(item.Quantity <= item.MinQuantity ? "color:red" : "")">
        <td>
            @item.Name
        </td>
        <td>
            @item.Quantity
        </td>
        @if (Model.Type.Id == 11)
        {
            <td>
                @StaticData.CountPrinters(item.Id).ToString()
            </td>
        }

        @if (Model.Items.FirstOrDefault() != null)
        {
            foreach (var attribute in Model.Items.FirstOrDefault().ItemType.Attributes
                .Where(attribute => item.AttributeValues.FirstOrDefault(a => a.Attribute == attribute) != null))
            {
                if (!string.IsNullOrEmpty(item.AttributeValues.FirstOrDefault(a => a.Attribute == attribute).Value))
                {
                    if (attribute.Id == 2)
                    {
                        <td>
                            <font color=@item.AttributeValues.FirstOrDefault(a => a.Attribute == attribute).Value>&#11044</font>
                        </td>
                    }
                    else if (attribute.Id == 10)
                    {
                        <td>
                            @Html.ActionLink("Описание", "GoToSite", new {url = @item.AttributeValues.FirstOrDefault(a => a.Attribute == attribute).Value}, new {target = "_blank"})
                        </td>
                    }
                    else
                    {
                        <td>
                            @item.AttributeValues.FirstOrDefault(a => a.Attribute == attribute).Value
                        </td>
                    }
                }
                else
                {
                    <td></td>
                }
            }
        }
        <td style="color:black">
            @Html.ActionLink("Выдать", "Grant", new { id = item.Id }) |
            @Html.ActionLink("Принять", "Recieve", new { id = item.Id }) |
            @Html.ActionLink("История", "Index", "Histories", new { id = item.Id }, null) |
            @Html.ActionLink("Редактировать", "Edit", new { id = item.Id }) |
            @Html.ActionLink("Подробно", "Details", new { id = item.Id }) |
            @Html.ActionLink("Удалить", "Delete", new { id = item.Id })
        </td>
    </tr>
}
</table>
