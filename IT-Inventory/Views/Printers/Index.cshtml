@using IT_Inventory.Models
@model IEnumerable<Printer>

@{
    if (ViewBag.Office == "")
    {
        ViewBag.Title = "Все принтеры";
    }
    else
    {
        ViewBag.Title = "Принтеры (" + ViewBag.Office + ")";
    }
}

<h2>@ViewBag.Title</h2>
<h4>Количество: @ViewBag.Count</h4>

<p>
    @if (ViewBag.Office == "")
    {
        foreach (var office in StaticData.GetOffices().Where(o => StaticData.CountOfficePrinters(o.Id) > 0))
        {
            @Html.ActionLink(office.Name, "Index", new {officeId = office.Id}, new {@class = "btn btn-primary"})
        }
    }
    else
    {
        @Html.ActionLink("Все принтеры", "Index", null, new { @class = "btn btn-primary" })
    }
    @Html.ActionLink("Добавить принтер", "Create", null, new {@class = "btn btn-default"})
    @Html.ActionLink("Добавить картридж", "Create", "Items", new { id = 11 }, new { @class = "btn btn-default" })
    @Html.ActionLink("Все картриджи", "Index", "Items", new { id = 11 }, new { @class = "btn btn-default" })
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Department)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Place)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Cartridges)
        </th>

        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr style="@(StaticData.IsCartridgesOver(item.Id) ? "color:red" : "")">
        <td>
            @Html.DisplayFor(modelItem => item.Name)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Department.Name)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Place)
        </td>
        <td>
            <table>
                <tr>
                    @foreach (var cartridge in item.Cartridges.Where(c => c.AttributeValues.FirstOrDefault(a => a.Attribute.Id == 2) != null).OrderBy(c => c.AttributeValues.FirstOrDefault(a => a.Attribute.Id == 2).Value))
                    {
                        <td align="center">
                            &nbsp;<font color=@cartridge.AttributeValues.FirstOrDefault(a => a.Attribute.Id == 2).Value>&#11044</font>&nbsp;<br/>
                        @*</td>
                        <td>*@
                            <font size="4">@Html.ActionLink(cartridge.Quantity.ToString(), "Grant", "Items", new {id = cartridge.Id}, new { style = cartridge.Quantity <= cartridge.MinQuantity ? "color:red" : ""})</font>
                        </td>
                    }
                </tr>
            </table>
        </td>
        <td style="color:black">
            @Html.ActionLink("Редактировать", "Edit", new { id=item.Id }) |
            @Html.ActionLink("Подробно", "Details", new {id = item.Id}) <br/>
            @if (!string.IsNullOrEmpty(item.Ip))
            {
                @Html.ActionLink("Управлять", "Manage", new { ip = item.Ip } , new { target = "_blank" })@: |
            }
            @Html.ActionLink("Удалить", "Delete", new { id = item.Id })
        </td>
    </tr>
}

</table>
